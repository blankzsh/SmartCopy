
/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var C=Object.defineProperty;var S=Object.getOwnPropertyDescriptor;var k=Object.getOwnPropertyNames;var B=Object.prototype.hasOwnProperty;var v=(h,i)=>{for(var t in i)C(h,t,{get:i[t],enumerable:!0})},T=(h,i,t,e)=>{if(i&&typeof i=="object"||typeof i=="function")for(let n of k(i))!B.call(h,n)&&n!==t&&C(h,n,{get:()=>i[n],enumerable:!(e=S(i,n))||e.enumerable});return h};var L=h=>T(C({},"__esModule",{value:!0}),h);var l=(h,i,t)=>new Promise((e,n)=>{var a=r=>{try{o(t.next(r))}catch(u){n(u)}},s=r=>{try{o(t.throw(r))}catch(u){n(u)}},o=r=>r.done?e(r.value):Promise.resolve(r.value).then(a,s);o((t=t.apply(h,i)).next())});var P={};v(P,{default:()=>p});module.exports=L(P);var w=require("obsidian");var d=require("obsidian");var g=class extends d.PluginSettingTab{constructor(t,e){super(t,e);this.plugin=e}display(){let{containerEl:t}=this;t.empty(),t.createEl("h2",{text:"SmartCopy \u8BBE\u7F6E"}),t.createEl("h3",{text:"\u529F\u80FD\u542F\u7528\u8BBE\u7F6E"}),new d.Setting(t).setName("\u542F\u7528\u590D\u5236\u5F53\u524D\u884C").setDesc("\u5141\u8BB8\u4F7F\u7528\u5FEB\u6377\u952E\u590D\u5236\u5149\u6807\u6240\u5728\u884C").addToggle(n=>n.setValue(this.plugin.settings.enableLineCopy).onChange(a=>l(this,null,function*(){this.plugin.settings.enableLineCopy=a,yield this.plugin.saveSettings()}))),new d.Setting(t).setName("\u542F\u7528\u590D\u5236\u5F53\u524D\u6BB5\u843D").setDesc("\u5141\u8BB8\u4F7F\u7528\u5FEB\u6377\u952E\u590D\u5236\u5F53\u524D\u6BB5\u843D").addToggle(n=>n.setValue(this.plugin.settings.enableParagraphCopy).onChange(a=>l(this,null,function*(){this.plugin.settings.enableParagraphCopy=a,yield this.plugin.saveSettings()}))),new d.Setting(t).setName("\u542F\u7528\u590D\u5236\u4EE3\u7801\u5757").setDesc("\u5141\u8BB8\u4F7F\u7528\u5FEB\u6377\u952E\u590D\u5236\u5F53\u524D\u4EE3\u7801\u5757").addToggle(n=>n.setValue(this.plugin.settings.enableCodeBlockCopy).onChange(a=>l(this,null,function*(){this.plugin.settings.enableCodeBlockCopy=a,yield this.plugin.saveSettings()}))),new d.Setting(t).setName("\u542F\u7528\u8868\u683C\u590D\u5236").setDesc("\u5141\u8BB8\u590D\u5236\u8868\u683C\u884C/\u5217/\u5355\u5143\u683C").addToggle(n=>n.setValue(this.plugin.settings.enableTableCopy).onChange(a=>l(this,null,function*(){this.plugin.settings.enableTableCopy=a,yield this.plugin.saveSettings()}))),new d.Setting(t).setName("\u542F\u7528\u5220\u9664\u5F53\u524D\u884C").setDesc("\u5141\u8BB8\u4F7F\u7528\u5FEB\u6377\u952E\u5220\u9664\u5149\u6807\u6240\u5728\u884C").addToggle(n=>n.setValue(this.plugin.settings.enableLineDelete).onChange(a=>l(this,null,function*(){this.plugin.settings.enableLineDelete=a,yield this.plugin.saveSettings()}))),new d.Setting(t).setName("\u542F\u7528\u5220\u9664\u5F53\u524D\u6BB5\u843D").setDesc("\u5141\u8BB8\u4F7F\u7528\u5FEB\u6377\u952E\u5220\u9664\u5F53\u524D\u6BB5\u843D").addToggle(n=>n.setValue(this.plugin.settings.enableParagraphDelete).onChange(a=>l(this,null,function*(){this.plugin.settings.enableParagraphDelete=a,yield this.plugin.saveSettings()}))),t.createEl("h3",{text:"\u7C98\u8D34\u8BBE\u7F6E"}),new d.Setting(t).setName("\u9ED8\u8BA4\u7C98\u8D34\u884C\u4E3A").setDesc("\u9009\u62E9\u7C98\u8D34\u65F6\u7684\u9ED8\u8BA4\u884C\u4E3A").addDropdown(n=>n.addOption("plain","\u7EAF\u6587\u672C").addOption("formatted","\u683C\u5F0F\u5316").addOption("blockquote","\u5F15\u7528\u5757").setValue(this.plugin.settings.defaultPasteBehavior).onChange(a=>l(this,null,function*(){this.plugin.settings.defaultPasteBehavior=a,yield this.plugin.saveSettings()}))),new d.Setting(t).setName("\u7C98\u8D34\u65F6\u79FB\u9664\u94FE\u63A5\u683C\u5F0F").setDesc("\u7C98\u8D34\u65F6\u81EA\u52A8\u79FB\u9664\u94FE\u63A5\u683C\u5F0F\uFF0C\u53EA\u4FDD\u7559\u6587\u672C").addToggle(n=>n.setValue(this.plugin.settings.removeLinkFormattingOnPaste).onChange(a=>l(this,null,function*(){this.plugin.settings.removeLinkFormattingOnPaste=a,yield this.plugin.saveSettings()}))),t.createEl("h3",{text:"\u754C\u9762\u8BBE\u7F6E"}),new d.Setting(t).setName("\u663E\u793A\u72B6\u6001\u680F\u63D0\u793A").setDesc("\u5728\u72B6\u6001\u680F\u663E\u793A\u590D\u5236/\u7C98\u8D34\u64CD\u4F5C\u63D0\u793A").addToggle(n=>n.setValue(this.plugin.settings.showStatusBarHints).onChange(a=>l(this,null,function*(){this.plugin.settings.showStatusBarHints=a,yield this.plugin.saveSettings(),a?this.plugin.updateStatusBar("SmartCopy \u5DF2\u542F\u7528"):this.plugin.updateStatusBar("")}))),t.createEl("h3",{text:"\u5FEB\u6377\u952E"}),t.createEl("p",{text:'\u53EF\u4EE5\u901A\u8FC7 Obsidian \u7684 "\u8BBE\u7F6E" -> "\u5FEB\u6377\u952E" \u6765\u81EA\u5B9A\u4E49\u4EE5\u4E0B\u547D\u4EE4\u7684\u5FEB\u6377\u952E\uFF1A'}),[{id:"smart-copy-keymap",name:"\u667A\u80FD\u590D\u5236"},{id:"smart-delete-keymap",name:"\u667A\u80FD\u5220\u9664"},{id:"copy-current-line",name:"\u590D\u5236\u5F53\u524D\u884C"},{id:"delete-current-line",name:"\u5220\u9664\u5F53\u524D\u884C"},{id:"copy-current-paragraph",name:"\u590D\u5236\u5F53\u524D\u6BB5\u843D"},{id:"delete-current-paragraph",name:"\u5220\u9664\u5F53\u524D\u6BB5\u843D"},{id:"copy-current-code-block",name:"\u590D\u5236\u5F53\u524D\u4EE3\u7801\u5757"},{id:"paste-as-plain-text",name:"\u7C98\u8D34\u4E3A\u7EAF\u6587\u672C"},{id:"paste-as-block-quote",name:"\u7C98\u8D34\u4E3A\u5F15\u7528\u5757"}].forEach(n=>{new d.Setting(t).setName(n.name).setDesc("\u53EF\u901A\u8FC7\u5FEB\u6377\u952E\u8BBE\u7F6E\u81EA\u5B9A\u4E49")})}};var c=class{static getCurrentParagraphBounds(i,t){let e=t;for(;e>0&&i[e-1].trim()!=="";)e--;let n=t;for(;n<i.length-1&&i[n+1].trim()!=="";)n++;return{start:e,end:n}}static getCurrentCodeBlockBounds(i,t){let e=t;for(;e>=0&&!i[e].trim().startsWith("```");)e--;if(e<0)return null;let n=t;for(;n<i.length&&!i[n].trim().startsWith("```");)n++;return n>=i.length?null:{start:e,end:n}}static getCurrentHeadingSectionBounds(i,t){var s;let e=t;for(;e>=0&&!i[e].trim().startsWith("#");)e--;e<0&&(e=0);let n=t,a=((s=i[e].match(/^#+/))==null?void 0:s[0].length)||0;for(let o=e+1;o<i.length;o++){let u=i[o].match(/^#+/);if(u&&u[0].length<=a){n=o-1;break}n=o}return{start:e,end:n}}static isCursorInTable(i,t){let e=t;for(;e>=0&&!i[e].includes("|");)e--;let n=t;for(;n<i.length&&i[n].includes("|");)n++;return e>=0&&n<i.length}static getTableInfo(i,t){let e=t;for(;e>=0&&i[e].includes("|");)e--;e++;let n=t;for(;n<i.length&&i[n].includes("|");)n++;n--;let a=[];for(let r=e;r<=n;r++){let u=i[r].split("|").map(m=>m.trim()).filter((m,b,f)=>b>0&&b<f.length-1);a.push(u)}let s=-1,o=-1;for(let r=0;r<a.length;r++)if(e+r===t){s=r,o=0;break}return s===-1?null:{start:e,end:n,row:s,col:o,data:a}}static stripHtml(i){let t=document.createElement("div");return t.innerHTML=i,t.textContent||t.innerText||""}static convertToBlockquote(i){return i.split(`
`).map(t=>`> ${t}`).join(`
`)}static convertToTodoList(i){return i.split(`
`).map(t=>`- [ ] ${t}`).join(`
`)}static convertToInlineCode(i){return i.includes(`
`)===!1&&i.length<50?`\`${i}\``:`\`\`\`
${i}
\`\`\``}};var y={enableLineCopy:!0,enableParagraphCopy:!0,enableCodeBlockCopy:!0,enableTableCopy:!0,enableLineDelete:!0,enableParagraphDelete:!0,defaultPasteBehavior:"formatted",showStatusBarHints:!0,removeLinkFormattingOnPaste:!1};var p=class extends w.Plugin{onload(){return l(this,null,function*(){console.log("Loading SmartCopy plugin"),yield this.loadSettings(),this.addSettingTab(new g(this.app,this)),this.statusBar=this.addStatusBarItem(),this.statusBar.addClass("smartcopy-status-bar"),this.updateStatusBar("SmartCopy \u5DF2\u52A0\u8F7D"),this.registerEditorCommands(),this.registerKeymaps()})}onunload(){console.log("Unloading SmartCopy plugin")}loadSettings(){return l(this,null,function*(){this.settings=Object.assign({},y,yield this.loadData())})}saveSettings(){return l(this,null,function*(){yield this.saveData(this.settings)})}updateStatusBar(t){this.settings.showStatusBarHints&&this.statusBar.setText(t)}showNotification(t){let e=document.createElement("div");e.className="smartcopy-notification",e.textContent=t,document.body.appendChild(e),setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},3e3)}registerEditorCommands(){this.addCommand({id:"copy-current-line",name:"\u590D\u5236\u5F53\u524D\u884C",editorCallback:(t,e)=>{this.settings.enableLineCopy&&this.copyCurrentLine(t)}}),this.addCommand({id:"copy-current-paragraph",name:"\u590D\u5236\u5F53\u524D\u6BB5\u843D",editorCallback:(t,e)=>{this.settings.enableParagraphCopy&&this.copyCurrentParagraph(t)}}),this.addCommand({id:"copy-current-heading-section",name:"\u590D\u5236\u5F53\u524D\u6807\u9898\u90E8\u5206",editorCallback:(t,e)=>{this.copyCurrentHeadingSection(t)}}),this.addCommand({id:"copy-current-code-block",name:"\u590D\u5236\u5F53\u524D\u4EE3\u7801\u5757",editorCallback:(t,e)=>{this.settings.enableCodeBlockCopy&&this.copyCurrentCodeBlock(t)}}),this.addCommand({id:"smart-copy",name:"\u667A\u80FD\u590D\u5236",editorCallback:(t,e)=>{this.smartCopy(t)}}),this.addCommand({id:"paste-as-plain-text",name:"\u7C98\u8D34\u4E3A\u7EAF\u6587\u672C",editorCallback:(t,e)=>{this.pasteAsPlainText(t)}}),this.addCommand({id:"paste-as-block-quote",name:"\u7C98\u8D34\u4E3A\u5F15\u7528\u5757",editorCallback:(t,e)=>{this.pasteAsBlockQuote(t)}}),this.addCommand({id:"paste-as-todo-list",name:"\u7C98\u8D34\u4E3A\u5F85\u529E\u5217\u8868\u9879",editorCallback:(t,e)=>{this.pasteAsTodoList(t)}}),this.addCommand({id:"paste-as-inline-code",name:"\u7C98\u8D34\u4E3A\u884C\u5185\u4EE3\u7801",editorCallback:(t,e)=>{this.pasteAsInlineCode(t)}}),this.addCommand({id:"delete-current-line",name:"\u5220\u9664\u5F53\u524D\u884C",editorCallback:(t,e)=>{this.settings.enableLineDelete&&this.deleteCurrentLine(t)}}),this.addCommand({id:"delete-current-paragraph",name:"\u5220\u9664\u5F53\u524D\u6BB5\u843D",editorCallback:(t,e)=>{this.settings.enableParagraphDelete&&this.deleteCurrentParagraph(t)}}),this.addCommand({id:"smart-delete",name:"\u667A\u80FD\u5220\u9664",editorCallback:(t,e)=>{this.smartDelete(t)}})}registerKeymaps(){this.addCommand({id:"smart-copy-keymap",name:"\u667A\u80FD\u590D\u5236\uFF08\u5FEB\u6377\u952E\uFF09",hotkeys:[{modifiers:["Mod","Shift"],key:"c"}],editorCallback:(t,e)=>{this.smartCopy(t)}}),this.addCommand({id:"smart-delete-keymap",name:"\u667A\u80FD\u5220\u9664\uFF08\u5FEB\u6377\u952E\uFF09",hotkeys:[{modifiers:["Mod","Shift"],key:"d"}],editorCallback:(t,e)=>{this.smartDelete(t)}}),this.addCommand({id:"copy-line-keymap",name:"\u590D\u5236\u5F53\u524D\u884C\uFF08\u5FEB\u6377\u952E\uFF09",hotkeys:[{modifiers:["Mod","Alt"],key:"l"}],editorCallback:(t,e)=>{this.settings.enableLineCopy&&this.copyCurrentLine(t)}}),this.addCommand({id:"delete-line-keymap",name:"\u5220\u9664\u5F53\u524D\u884C\uFF08\u5FEB\u6377\u952E\uFF09",hotkeys:[{modifiers:["Mod","Alt"],key:"d"}],editorCallback:(t,e)=>{this.settings.enableLineDelete&&this.deleteCurrentLine(t)}}),this.addCommand({id:"copy-paragraph-keymap",name:"\u590D\u5236\u5F53\u524D\u6BB5\u843D\uFF08\u5FEB\u6377\u952E\uFF09",hotkeys:[{modifiers:["Mod","Alt"],key:"p"}],editorCallback:(t,e)=>{this.settings.enableParagraphCopy&&this.copyCurrentParagraph(t)}}),this.addCommand({id:"delete-paragraph-keymap",name:"\u5220\u9664\u5F53\u524D\u6BB5\u843D\uFF08\u5FEB\u6377\u952E\uFF09",hotkeys:[{modifiers:["Mod","Alt"],key:"x"}],editorCallback:(t,e)=>{this.settings.enableParagraphDelete&&this.deleteCurrentParagraph(t)}})}copyCurrentLine(t){let e=t.getCursor(),n=t.getLine(e.line);navigator.clipboard.writeText(n),this.updateStatusBar("\u5DF2\u590D\u5236\u5F53\u524D\u884C"),this.showNotification("\u5DF2\u590D\u5236\u5F53\u524D\u884C\u5230\u526A\u8D34\u677F")}copyCurrentParagraph(t){let e=t.getCursor(),a=t.getValue().split(`
`),s=c.getCurrentParagraphBounds(a,e.line),o=a.slice(s.start,s.end+1).join(`
`);navigator.clipboard.writeText(o),this.updateStatusBar("\u5DF2\u590D\u5236\u5F53\u524D\u6BB5\u843D"),this.showNotification("\u5DF2\u590D\u5236\u5F53\u524D\u6BB5\u843D\u5230\u526A\u8D34\u677F")}copyCurrentHeadingSection(t){let e=t.getCursor(),a=t.getValue().split(`
`),s=c.getCurrentHeadingSectionBounds(a,e.line),o=a.slice(s.start,s.end+1).join(`
`);navigator.clipboard.writeText(o),this.updateStatusBar("\u5DF2\u590D\u5236\u5F53\u524D\u6807\u9898\u90E8\u5206"),this.showNotification("\u5DF2\u590D\u5236\u5F53\u524D\u6807\u9898\u90E8\u5206\u5230\u526A\u8D34\u677F")}copyCurrentCodeBlock(t){let e=t.getCursor(),a=t.getValue().split(`
`),s=c.getCurrentCodeBlockBounds(a,e.line);if(!s){this.showNotification("\u5149\u6807\u4E0D\u5728\u4EE3\u7801\u5757\u5185");return}let o=a.slice(s.start,s.end+1).join(`
`);navigator.clipboard.writeText(o),this.updateStatusBar("\u5DF2\u590D\u5236\u5F53\u524D\u4EE3\u7801\u5757"),this.showNotification("\u5DF2\u590D\u5236\u5F53\u524D\u4EE3\u7801\u5757\u5230\u526A\u8D34\u677F")}smartCopy(t){let e=t.getCursor(),a=t.getValue().split(`
`);if(c.getCurrentCodeBlockBounds(a,e.line)){this.copyCurrentCodeBlock(t);return}if(c.isCursorInTable(a,e.line)){this.copyCurrentParagraph(t);return}if(a[e.line].trim().startsWith("#")){this.copyCurrentHeadingSection(t);return}this.copyCurrentParagraph(t)}pasteAsPlainText(t){return l(this,null,function*(){try{let e=yield navigator.clipboard.readText(),n=c.stripHtml(e);this.settings.removeLinkFormattingOnPaste&&(n=n.replace(/\$\$[^\$\$]*\$\$/g,"")),t.replaceSelection(n),this.updateStatusBar("\u5DF2\u7C98\u8D34\u4E3A\u7EAF\u6587\u672C"),this.showNotification("\u5DF2\u7C98\u8D34\u4E3A\u7EAF\u6587\u672C")}catch(e){console.error("\u7C98\u8D34\u5931\u8D25:",e),this.showNotification("\u7C98\u8D34\u5931\u8D25")}})}pasteAsBlockQuote(t){return l(this,null,function*(){try{let e=yield navigator.clipboard.readText(),n=c.convertToBlockquote(e);t.replaceSelection(n),this.updateStatusBar("\u5DF2\u7C98\u8D34\u4E3A\u5F15\u7528\u5757"),this.showNotification("\u5DF2\u7C98\u8D34\u4E3A\u5F15\u7528\u5757")}catch(e){console.error("\u7C98\u8D34\u5931\u8D25:",e),this.showNotification("\u7C98\u8D34\u5931\u8D25")}})}pasteAsTodoList(t){return l(this,null,function*(){try{let e=yield navigator.clipboard.readText(),n=c.convertToTodoList(e);t.replaceSelection(n),this.updateStatusBar("\u5DF2\u7C98\u8D34\u4E3A\u5F85\u529E\u5217\u8868\u9879"),this.showNotification("\u5DF2\u7C98\u8D34\u4E3A\u5F85\u529E\u5217\u8868\u9879")}catch(e){console.error("\u7C98\u8D34\u5931\u8D25:",e),this.showNotification("\u7C98\u8D34\u5931\u8D25")}})}pasteAsInlineCode(t){return l(this,null,function*(){try{let e=yield navigator.clipboard.readText(),n=c.convertToInlineCode(e);t.replaceSelection(n),this.updateStatusBar("\u5DF2\u7C98\u8D34\u4E3A\u4EE3\u7801"),this.showNotification("\u5DF2\u7C98\u8D34\u4E3A\u4EE3\u7801")}catch(e){console.error("\u7C98\u8D34\u5931\u8D25:",e),this.showNotification("\u7C98\u8D34\u5931\u8D25")}})}deleteCurrentLine(t){let e=t.getCursor(),n=t.getLine(e.line);t.setSelection({line:e.line,ch:0},{line:e.line,ch:n.length}),t.replaceSelection(""),this.updateStatusBar("\u5DF2\u5220\u9664\u5F53\u524D\u884C"),this.showNotification("\u5DF2\u5220\u9664\u5F53\u524D\u884C")}deleteCurrentParagraph(t){let e=t.getCursor(),a=t.getValue().split(`
`),s=c.getCurrentParagraphBounds(a,e.line),o={line:s.start,ch:0},r=a[s.end],u={line:s.end,ch:r.length};t.setSelection(o,u),t.replaceSelection(""),this.updateStatusBar("\u5DF2\u5220\u9664\u5F53\u524D\u6BB5\u843D"),this.showNotification("\u5DF2\u5220\u9664\u5F53\u524D\u6BB5\u843D")}smartDelete(t){let e=t.getCursor(),a=t.getValue().split(`
`);if(c.getCurrentCodeBlockBounds(a,e.line)){this.deleteCurrentLine(t);return}if(c.isCursorInTable(a,e.line)){this.deleteCurrentLine(t);return}if(a[e.line].trim().startsWith("#")){this.deleteCurrentHeadingSection(t);return}this.deleteCurrentParagraph(t)}deleteCurrentHeadingSection(t){let e=t.getCursor(),a=t.getValue().split(`
`),s=c.getCurrentHeadingSectionBounds(a,e.line),o={line:s.start,ch:0},r=a[s.end],u={line:s.end,ch:r.length};t.setSelection(o,u),t.replaceSelection(""),this.updateStatusBar("\u5DF2\u5220\u9664\u5F53\u524D\u6807\u9898\u90E8\u5206"),this.showNotification("\u5DF2\u5220\u9664\u5F53\u524D\u6807\u9898\u90E8\u5206")}};
